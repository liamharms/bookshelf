{% extends "base.html" %}

{% block title %}{{ tag.label }} - {{ super() }}{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">{{ tag.label }}</h1>
    <div class="page-actions">
        <a href="{{ url_for('tags.tag_edit', id=tag.id) }}" class="button button-primary">Edit</a>
        <button class="button button-danger" onclick="openDeleteModal()">Delete</button>
    </div>
</div>

<h3 class="section-title">Books with this tag</h3>

{% if tag.works|length > 0 %}
<div class="works-list">
    {% for work in tag.works %}
    <a href="{{ url_for('books.work_detail', id=work.id) }}" class="work-item">
        <div class="work-content">
            <h4 class="work-title">{{ work.title }}</h4>
            <p class="work-isbn">ISBN: {{ work.isbn }}</p>
            {% if work.description %}
            <p class="work-description">{{ work.description|truncate(100) }}</p>
            {% endif %}
            {% if work.authors %}
            <div class="work-tags">
                {% for author in work.authors %}
                <span class="info-badge info-badge-primary">{{ author.primary_name }}</span>
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </a>
    {% endfor %}
</div>
{% else %}
<div class="alert-info">
    No works found with this tag.
</div>
{% endif %}

<div class="form-actions">
    <a href="{{ url_for('tags.tag_list') }}" class="button button-secondary">Back to Tags</a>
</div>

<!-- Delete Modal -->
<div id="deleteModal" class="modal">
    <div class="modal-overlay" onclick="closeDeleteModal()"></div>
    <div class="modal-container">
        <div class="modal-header">
            <h3 class="modal-title">Confirm Delete</h3>
            <button class="modal-close" onclick="closeDeleteModal()">&times;</button>
        </div>
        <div class="modal-body">
            Are you sure you want to delete "{{ tag.label }}"? This will remove information from {{ tag.works|length }} works.
        </div>
        <div class="modal-footer">
            <button class="button button-secondary" onclick="closeDeleteModal()">Cancel</button>
            <form action="{{ url_for('tags.tag_delete', id=tag.id) }}" method="post" style="display: inline;">
                <button type="submit" class="button button-danger">Delete</button>
            </form>
        </div>
    </div>
</div>

<script>
function openDeleteModal() {
    document.getElementById('deleteModal').classList.add('active');
}

function closeDeleteModal() {
    document.getElementById('deleteModal').classList.remove('active');
}
</script>
{% endblock %}