{% extends "base.html" %}

{% block title %}{{ copy.work.title }} - {{ super() }}{% endblock %}

{% block content %}

<a href="{{ url_for('books.copies_list') }}" class="button button-secondary detail-back-button">‚Üê Back to Copies</a>

<div class="detail-layout">
    <div class="detail-sidebar">
        <div class="detail-cover-container">
            {% if copy.work.cover_url %}
            <img src="{{ copy.work.cover_url }}" class="detail-cover" alt="{{ copy.work.title }}">
            {% else %}
            <svg class="detail-cover-placeholder" viewBox="0 0 100 150" fill="none">
                <rect width="100" height="150" fill="var(--bg-hover)"/>
                <rect x="10" y="20" width="80" height="2" fill="var(--border-color)"/>
                <rect x="10" y="35" width="60" height="2" fill="var(--border-color)"/>
                <rect x="10" y="50" width="70" height="2" fill="var(--border-color)"/>
                <path d="M30 80 L50 100 L70 80" stroke="var(--border-color)" stroke-width="2" fill="none"/>
            </svg>
            {% endif %}
        </div>
        <div class="detail-divider"></div>
        <h1 class="detail-title">{{ copy.work.title }}</h1>
        <div class="detail-actions">
            <a href="{{ url_for('books.copy_edit', work_id=copy.work_id, copy_id=copy.id) }}" class="button button-primary">Edit</a>
            <button class="button button-danger" onclick="openDeleteModal()">Delete</button>
        </div>
    </div>

    <div class="detail-content">
        <div class="detail-info-card">
            <h3 class="info-section-title">Copy Information</h3>
            
            <div class="info-item">
                <strong class="info-label">Location:</strong>
                <span class="info-value">{{ copy.location.name }}</span>
            </div>
            
            {% if copy.condition %}
            <div class="info-item">
                <strong class="info-label">Condition:</strong>
                <span class="info-value">{{ copy.condition }}</span>
            </div>
            {% endif %}
            
            <div class="info-item">
                <strong class="info-label">Acquired:</strong>
                <span class="info-value">{{ copy.acquired.strftime('%B %d, %Y') if copy.acquired else 'Unknown' }}</span>
            </div>
            
            {% if copy.owner %}
            <div class="info-item">
                <strong class="info-label">Owner:</strong>
                <span class="info-value">{{ copy.owner.username }}</span>
            </div>
            {% endif %}
            
            {% if copy.borrower %}
            <div class="info-item">
                <strong class="info-label">Lent to:</strong>
                <span class="info-value">{{ copy.borrower.username }}</span>
            </div>
            {% endif %}
        </div>

        <div class="detail-info-card">
            <h3 class="info-section-title">Work Information</h3>
            
            {% if copy.work.isbn %}
            <div class="info-item">
                <strong class="info-label">ISBN:</strong>
                <span class="info-value">{{ copy.work.isbn }}</span>
            </div>
            {% endif %}
            
            {% if copy.work.authors %}
            <div class="info-item">
                <strong class="info-label">Authors:</strong>
                <div class="info-badges">
                    {% for author in copy.work.authors %}
                    <a href="{{ url_for('authors.author_detail', id=author.id) }}" class="info-badge info-badge-primary">{{ author.primary_name }}</a>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            {% if copy.work.tags %}
            <div class="info-item">
                <strong class="info-label">Tags:</strong>
                <div class="info-badges">
                    {% for tag in copy.work.tags %}
                    <a href="{{ url_for('tags.tag_detail', id=tag.id) }}" class="info-badge info-badge-secondary">{{ tag.label }}</a>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            {% if copy.work.description %}
            <div class="info-item">
                <strong class="info-label">Description:</strong>
                <p class="info-description">{{ copy.work.description }}</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Delete Modal -->
<div id="deleteModal" class="modal">
    <div class="modal-overlay" onclick="closeDeleteModal()"></div>
    <div class="modal-container">
        <div class="modal-header">
            <h3 class="modal-title">Confirm Delete</h3>
            <button class="modal-close" onclick="closeDeleteModal()">&times;</button>
        </div>
        <div class="modal-body">
            Are you sure you want to delete "{{ copy.work.title }}"?
        </div>
        <div class="modal-footer">
            <button class="button button-secondary" onclick="closeDeleteModal()">Cancel</button>
            <form action="{{ url_for('books.copy_delete', id=copy.id) }}" method="post" style="display: inline;">
                <button type="submit" class="button button-danger">Delete</button>
            </form>
        </div>
    </div>
</div>

<script>
function openDeleteModal() {
    document.getElementById('deleteModal').classList.add('active');
}

function closeDeleteModal() {
    document.getElementById('deleteModal').classList.remove('active');
}
</script>
{% endblock %}